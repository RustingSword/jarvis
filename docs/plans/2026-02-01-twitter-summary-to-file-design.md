# Twitter 汇总写入文件并发送设计

日期：2026-02-01

## 背景
现有 `twitter_for_you_summary` 任务会生成主题汇总与 AI 详述，但结果仅在消息中返回。需求变更为：将汇总结果写入任务时间对应的文件，并发送给主人。

## 目标
- 汇总结果自动落盘并发送。
- 保持主题聚类输出结构，AI 主题更详细。
- 最小改动：仅调整 `config.yaml` 指令文案，不改调度逻辑。

## 文件规范
- 目录：`/home/nazgul/jarvis/reports/twitter/`
- 文件名：`twitter_for_you_YYYY-MM-DD_HHMM.txt`（以任务触发时间为准）
- 若目录不存在需先创建。

## 输出结构（不变）
1) 主题汇总：每个主题 2–4 句概述。
2) AI 主题详述：更详细，包含关键观点、潜在影响、争议点。
3) 代表推文清单：按主题列出 2–4 条代表推文，含作者/时间/摘要/链接/点赞/回复/转发。

## 写入与发送流程
- 先生成完整汇总正文。
- 写入上述文件路径。
- 回复中先给 2–3 句简短文本摘要（不重复文件内容），再输出 `send_to_user:///绝对路径` 触发发送（保证文本先、媒体后）。
- 写入失败则明确错误原因，但仍输出文本摘要。

## 配置改动
- 修改 `config.yaml` 中 `triggers.scheduler.twitter_for_you_summary.message` 指令文案，加入文件写入与发送要求。

## 验证方式
- 通过 webhook 触发一次测试任务。
- 检查文件是否生成、内容是否符合结构。
- 确认 Telegram 先收到文本摘要、再收到文件。
